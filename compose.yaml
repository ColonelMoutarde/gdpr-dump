services:
    app:
        build:
            context: 'docker/php-cli'
            args:
                APP_UID: '${UID}'
                APP_GID: '${GID}'
        environment:
            COMPOSER_AUTH: '${COMPOSER_AUTH:-}'
            DB_HOST: 'mysql'
        depends_on:
            - 'mysql'
            - 'postgres'
        volumes:
            - '.:/var/www/html:rw,cached'
            - 'composer:/home/www/.composer'

    mysql:
        image: 'mariadb:10.6'
        ports:
            - 3306
        environment:
            MYSQL_ROOT_PASSWORD: '!root'
            MYSQL_DATABASE: 'tests'
            MYSQL_USER: 'tests'
            MYSQL_PASSWORD: 'tests'
        volumes:
            - 'db-data:/var/lib/mysql'
            - './docker/db-data:/docker-entrypoint-initdb.d'
    postgres:
        image: 'postgres:16-alpine'
        ports:
            - '5432:5432'
        volumes:
            - ~/apps/postgres:/var/lib/postgresql/data
        environment:
            - POSTGRES_PASSWORD=tests
            - POSTGRES_USER=tests
            - POSTGRES_DB=tests
volumes:
    composer:
    db-data:
